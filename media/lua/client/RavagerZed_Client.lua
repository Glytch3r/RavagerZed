--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:     glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]

RavagerZed = RavagerZed or {}

local Commands = {}
Commands.RavagerZed = {}


-----------------------            ---------------------------

function RavagerZed.isShouldObserve(zed)
    local targ = zed:getTarget()
    if not targ then return false end

    local minDist = SandboxVars.RavagerZed.DistToChase or 6
    local minSeenTime = SandboxVars.RavagerZed.SeenTime or 4
    local seen =  zed:getTargetSeenTime() * 100
    return RavagerZed.checkDist(zed, targ) <= minDist and seen <= minSeenTime

end



function RavagerZed.isStars(targ)
    if not targ then return false end
    local isStars = false
    local fac = Faction.getPlayerFaction(targ) 
    if not fac then return false end
    local facName = fac:getName() 
    if facName then
        facName = string.lower(facName) 
        isStars = facName == "stars" or  facName == "s.t.a.r.s." or  facName == "s.t.a.r.s" 
    end
    return isStars
end


function RavagerZed.coreFunc(zed)
    if not zed then return end
    local targ = zed:getTarget()
    if not targ and zed:getVariableBoolean('Ravager_Slam') == true then
        zed:setVariable('Ravager_Slam', false)
    end
    if RavagerZed.isRavagerZed(zed) then
        local react = zed:getHitReaction() 
        if react and react == "Ravager_Slam" then
            if targ and getCore():getDebug() then 
                targ:addLineChatElement(tostring("Danger!"))
            end
            zed:setVariable('Ravager_Slam', true)
        end
        if zed:getModData()['RavagerZed_Init'] == nil then
            RavagerZed.setStats(zed)
        end

        if not zed:getVariableBoolean('isRavagerZed') then
            zed:setVariable('isRavagerZed', true)
        end
   
   --[[  
        if SandboxVars.RavagerZed.stagStep and not zed:isDead() then 
         
        end   
    local Ravager_Slam = false
        local isStars = false
        if targ then
            isStars = RavagerZed.isStars(targ)
            Ravager_Slam = isStars or not targ:isMoving()
        end ]]
--[[ 
        zed:getModData()['Ravager_Slam'] = zed:getModData()['Ravager_Slam'] or false
        if zed:getVariableBoolean('Ravager_Slam') ~= Ravager_Slam then
            if Ravager_Slam and not zed:getModData()['Ravager_Slam']  then
                zed:setVariable('Ravager_Slam', false)
                zed:setHitReaction("Ravager_Taunt") 
                zed:getModData()['Ravager_Slam'] = Ravager_Slam
            end
       
            zed:setVariable('Ravager_Slam', Ravager_Slam)
        end
 ]]

    else
        if zed:getVariableBoolean('isRavagerZed') then
            zed:setVariable('isRavagerZed', false)
            zed:getModData()['RavagerZed_Init'] = nil
        end
    end
end

Events.OnZombieUpdate.Remove(RavagerZed.coreFunc)
Events.OnZombieUpdate.Add(RavagerZed.coreFunc)


-----------------------            ---------------------------

-----------------------            ---------------------------

Commands.RavagerZed.isRavagerZed = function(args)
    local source = getPlayer();
    local player = getPlayerByOnlineID(args.id)
    local zedID = args.zedID
    if type(zedID) == 'string' then zedID = tonumber(zedID) end
    local zed = RavagerZed.findzedID(zedID)
    if zed ~= nil then
		if source ~= player then
			if args.isRavagerZed == 'true' then
				zed:setVariable('isRavagerZed', 'true');
			else
				zed:setVariable('isRavagerZed', 'false');
			end
		end
    end
end

Commands.RavagerZed.KnockDown = function(args)
    local source = getPlayer();
    local player = getPlayerByOnlineID(args.id)
    local zedID = args.zedID
    if type(zedID) == 'string' then zedID = tonumber(zedID) end
    local zed = RavagerZed.findzedID(zedID)
	if source ~= player then
		if zed ~= nil then
			zed:setKnockedDown(true)
		end
	end
end

-----------------------            ---------------------------

Commands.RavagerZed.isRavagerPl = function(args)
    local source = getPlayer();
    local player = getPlayerByOnlineID(args.id)
    if player ~= nil then
        if source ~= player then
            if args.isRavagerPl then
                --RavagerZed.wearRavagerZed(player)
                --player:setHideWeaponModel(true)
                player:setVariable('isRavagerPl', "true");
            else
                --RavagerZed.clearRavagerZedSkin(player)
                --player:setHideWeaponModel(false)
                player:setVariable('isRavagerPl', "false");
            end
        end
    end
    --player:resetModelNextFrame();
end

Commands.RavagerZed.stagPl = function(args)
    local pl = getPlayer();
    local targ = getPlayerByOnlineID(args.id)
    if targ ~= nil then
        if pl ~= targ then
           
            local pl = getPlayer()
            pl:setBumpType("pushedbehind");   --pushedFront
            pl:setVariable("BumpFall", true);
            pl:setVariable("BumpFallType", "pushedbehind");    --pushedFront

        end
    end
end

Commands.RavagerZed.grapplePl = function(args)
    local pl = getPlayer();
    local targ = getPlayerByOnlineID(args.id)
    if targ ~= nil then
        if pl ~= targ then
           
            pl:setVariable("Ravager", "Ravager_GrappleReact");

        end
    end
end



Events.OnServerCommand.Add(function(module, command, args)
	if Commands[module] and Commands[module][command] then
		Commands[module][command](args)
	end
end)
