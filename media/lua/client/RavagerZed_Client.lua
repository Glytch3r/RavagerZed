--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:     glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]

RavagerZed = RavagerZed or {}

local Commands = {}
Commands.RavagerZed = {}


-----------------------            ---------------------------

function RavagerZed.isShouldObserve(zed)
    local targ = zed:getTarget()
    if not targ then return false end

    local minDist = SandboxVars.RavagerZed.DistToChase or 6
    local minSeenTime = SandboxVars.RavagerZed.SeenTime or 4
    local seen =  zed:getTargetSeenTime() * 100
    return RavagerZed.checkDist(zed, targ) <= minDist and seen <= minSeenTime

end



function RavagerZed.isStars(targ)
    if not targ then return false end
    local isStars = false
    local fac = Faction.getPlayerFaction(targ) 
    if not fac then return false end
    local facName = fac:getName() 
    if facName then
        facName = string.lower(facName) 
        isStars = facName == "stars" or  facName == "s.t.a.r.s." or  facName == "s.t.a.r.s" 
    end
    return isStars
end

function RavagerZed.setSprinter(zed, isToSprint)
    if not zed then return end

    local wt = zed:getVariableString("zombieWalkType")
    if not wt then return end

    local num = string.match(wt, "(%d)$")
    if not num then return end

    if isToSprint then
        zed:setWalkType("sprint" .. num)
    else
        zed:setWalkType(num)
    end

    zed:makeInactive(true)
    zed:makeInactive(false)
    zed:DoZombieStats()
end

function RavagerZed.isSprinter(zed)
    if not zed then return false end
    local wt = zed:getVariableString("zombieWalkType")
    if not wt then return false end
    return string.find(wt, "^sprint") ~= nil
end

function RavagerZed.isShouldSprint(zed)
    if not zed then return false end
    return zed:getVariableBoolean('Ravager_Slam')
end

function RavagerZed.coreFunc(zed)
    if not zed then return end

    if RavagerZed.isRavagerZed(zed) then
        local isShouldSprint = RavagerZed.isShouldSprint(zed)
        local isSprinter = RavagerZed.isSprinter(zed)

        zed:setVariable('Ravager_Slam', isShouldSprint)
        zed:setVariable('isRavagerZed', true)

        if zed:getHitReaction() == "Ravager_Slam" and getCore():getDebug() then
            zed:addLineChatElement("Danger!")
        end

        if not zed:getModData()['RavagerZed_Init'] then
            RavagerZed.setStats(zed)
        end

        if isShouldSprint ~= isSprinter then
            RavagerZed.setSprinter(zed, isShouldSprint)
        end
    else
        if zed:getVariableBoolean('isRavagerZed') then
            zed:setVariable('isRavagerZed', false)
            zed:getModData()['RavagerZed_Init'] = nil
        end
    end
end


-----------------------            ---------------------------

-----------------------            ---------------------------

Commands.RavagerZed.KnockDown = function(args)
    local source = getPlayer();
    local player = getPlayerByOnlineID(args.id)
    local zedID = args.zedID
    if type(zedID) == 'string' then zedID = tonumber(zedID) end
    local zed = RavagerZed.findzedID(zedID)
	if source ~= player then
		if zed ~= nil then
			zed:setKnockedDown(true)
		end
	end
end

-----------------------            ---------------------------

Commands.RavagerZed.isRavagerPl = function(args)
    local source = getPlayer();
    local player = getPlayerByOnlineID(args.id)
    if player ~= nil then
        if source ~= player then
            if args.isRavagerPl then
                --RavagerZed.wearRavagerZed(player)
                --player:setHideWeaponModel(true)
                player:setVariable('isRavagerPl', "true");
            else
                --RavagerZed.clearRavagerZedSkin(player)
                --player:setHideWeaponModel(false)
                player:setVariable('isRavagerPl', "false");
            end
        end
    end
    --player:resetModelNextFrame();
end

Commands.RavagerZed.stagPl = function(args)
    local pl = getPlayer();
    local targ = getPlayerByOnlineID(args.id)
    if targ ~= nil then
        if pl ~= targ then
           
            local pl = getPlayer()
            pl:setBumpType("pushedbehind");   --pushedFront
            pl:setVariable("BumpFall", true);
            pl:setVariable("BumpFallType", "pushedbehind");    --pushedFront

        end
    end
end

Commands.RavagerZed.grapplePl = function(args)
    local pl = getPlayer();
    local targ = getPlayerByOnlineID(args.id)
    if targ ~= nil then
        if pl ~= targ then
           
            pl:setVariable("Ravager", "Ravager_GrappleReact");

        end
    end
end



Events.OnServerCommand.Add(function(module, command, args)
	if Commands[module] and Commands[module][command] then
		Commands[module][command](args)
	end
end)
