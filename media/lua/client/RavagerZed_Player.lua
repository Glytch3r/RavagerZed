--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:     glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]


RavagerZed = RavagerZed or {}
local Commands = {};
Commands.RavagerZed = {};

-----------------------            ---------------------------

function RavagerZed.wearRavagerZed(pl)
	pl = pl or getPlayer()
	--if not (getCore():getDebug() or isAdmin()) then return end
	--RavagerZed.clearRavagerZedSkin(pl)
	local item = InventoryItemFactory.CreateItem('Base.RavagerZed')
	local inv = pl:getInventory()
	local equip = inv:addItem(item);
	pl:setWornItem(equip:getBodyLocation(), equip);
	if not pl:isHideWeaponModel() then pl:setHideWeaponModel(true) end
	triggerEvent("OnClothingUpdated", pl)
	pl:resetModelNextFrame();
	pl:getModData()['isRavagerPl'] = true
	RavagerZed.plSync()
	if RavagerZed.isWIP then
		local msg = "wearRavagerZed"
		print(tostring(msg))
        pl:addLineChatElement(tostring(msg))
	end
end


-----------------------       ---------------------------


function RavagerZed.clearRavagerZedSkin(pl)
	pl = pl or getPlayer()

	local inv = pl:getInventory()
	for i = inv:getItems():size(), 1, -1 do
		local item = inv:getItems():get(i-1)
		if item and item:getFullType() == "Base.RavagerZed" then
			inv:DoRemoveItem(item)
			pl:removeWornItem(item)
			inv:Remove(item)
		end
	end
	pl:setHideWeaponModel(false)
	pl:clearWornItems();
	pl:resetModelNextFrame();
	pl:getModData()['isRavagerPl'] = false
	triggerEvent("OnClothingUpdated", pl)
	RavagerZed.plSync()
	if RavagerZed.isWIP then
		local msg = "clearRavagerZedSkin"
		print(tostring(msg))
        pl:addLineChatElement(tostring(msg))
	end
end
-----------------------            ---------------------------


function RavagerZed.wpnHide(pl, wpn)
	local bool = true
	if RavagerZed.isRavagerPl(pl) then
		bool = true
	else
		bool = false
	end
	pl:setHideWeaponModel(bool)
	JoypadState.disableGrab = bool;
	JoypadState.disableYInventory = bool;
	JoypadState.disableClimbOver = bool;
	JoypadState.disableSmashWindow = bool;
	JoypadState.disableReload = bool;
	ISBackButtonWheel.disableCrafting = bool;
	ISBackButtonWheel.disableMoveable = bool;
	pl:setIgnoreAutoVault(bool);
end
Events.OnEquipPrimary.Add(RavagerZed.wpnHide)
Events.OnEquipSecondary.Add(RavagerZed.wpnHide)
-----------------------            ---------------------------

function RavagerZed.isBiteReact(pl)
	local attacker = nil
	if pl:getVariableString("HitReaction") == "Bite" then

		attacker = pl:getVariableString("getLastTargettedBy")

		return true
	end
	return false
end

-----------------------            ---------------------------
function RavagerZed.isUnarmed(pl, wpn)
	return (tostring(WeaponType.getWeaponType(pl)) == 'barehand' or (wpn and wpn:getCategories():contains("Unarmed"))) or wpn == nil
end

---------------------
-----------------------            ---------------------------
 -- pl:getVariableBoolean('isRavagerPl')
function RavagerZed.plSync()
	local pl = getPlayer()
	if not pl then return end
	if pl:getModData()['isRavagerPl'] == nil then
		pl:getModData()['isRavagerPl'] = RavagerZed.isRavagerPl(pl)
	end


	if pl:getModData()['isRavagerPl'] == true then

		if not pl:getVariableBoolean('isRavagerPl') then
			pl:setVariable('isRavagerPl', 'true');
		end

		if isClient() then
			sendClientCommand('RavagerZed', 'isRavagerPl', {isRavagerPl = true})
		end

	else
		--if pl:getVariableBoolean('isRavagerPl') == true and pl:getModData()['isRavagerPl'] ~= nil  then

		if pl:getVariableBoolean('isRavagerPl') then
			pl:setVariable('isRavagerPl', 'false');
		end

		if isClient() then
			sendClientCommand('RavagerZed', 'isRavagerPl', {isRavagerPl = false})
		end
		--end
	end

end

--Events.OnPlayerUpdate.Add(RavagerZed.plSync)
Events.OnLoad.Add(RavagerZed.plSync)
Events.OnClothingUpdated.Add(RavagerZed.plSync)

Events.OnClothingUpdated.Add(function()
	if RavagerZed.isWIP then
		local msg = "OnClothingUpdated"
		print(tostring(msg))
        getPlayer():addLineChatElement(tostring(msg))
	end
end)
Events.OnScoreboardUpdate.Add(RavagerZed.plSync)

--[[
Events.OnPlayerDeath.Add(function(pl)
	if not (getCore():getDebug() or isAdmin()) then return end
	local preMod = "isRavagerPl: "..tostring(isRavagerPl(pl))
	pl:setVariable('isRavagerPl', 'false')
	local postMod = "isRavagerPl: "..tostring(isRavagerPl(pl))
	local report = tostring(preMod).."\n"..tostring(postMod)
	print(report)
	pl:addLineChatElement(tostring(report))
end)

 ]]







-----------------------            ---------------------------
-----------------------            ---------------------------
--[[
 function RavagerZed.BugPatch(pl)
	local pl = getPlayer()
 	if not (getCore():getDebug() or isAdmin()) then return end
	local preMod = "isRavagerPl: "..tostring(isRavagerPl(pl))
	pl:setVariable('isRavagerPl', 'false')
	local postMod = "isRavagerPl: "..tostring(isRavagerPl(pl))
	local report = tostring(preMod).."\n"..tostring(postMod)
	print(report)
	pl:addLineChatElement(tostring(report))
 end
 Events.OnPlayerDeath.Add(RavagerZed.BugPatch)
 ]]--
-----------------------            --------------------------

